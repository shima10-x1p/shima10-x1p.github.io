{% extends "base.html" %}

{% set site_summary = "日々の記録と開発メモ" %}

{% block title %}{{ SITENAME }}{% endblock title %}
{% block page_description %}{{ site_summary }}{% endblock page_description %}

{% block extra_head %}
    <meta property="og:type" content="website" />
    <meta property="og:title" content="{{ SITENAME }}" />
    <meta property="og:description" content="{{ site_summary }}" />
    <meta property="og:url" content="{{ SITEURL }}/" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="{{ SITENAME }}" />
    <meta name="twitter:description" content="{{ site_summary }}" />
{% endblock extra_head %}

{% block content %}
{% if articles_page and articles_page.object_list %}
    {% set article_list = articles_page.object_list %}
{% elif articles %}
    {% set article_list = articles %}
{% else %}
    {% set article_list = [] %}
{% endif %}

<div class="blog-list">
    <h2 class="section-title">記事一覧</h2>
    {% if article_list %}
        {% for article in article_list %}
        {% set thumbnail_path = article | resolve_article_thumbnail %}
        {% if thumbnail_path and (thumbnail_path.startswith("http://") or thumbnail_path.startswith("https://") or thumbnail_path.startswith("//")) %}
            {% set thumbnail_src = thumbnail_path %}
        {% elif thumbnail_path %}
            {% set thumbnail_src = SITEURL ~ "/" ~ thumbnail_path %}
        {% else %}
            {% set thumbnail_src = none %}
        {% endif %}
        <article class="blog-post">
            <a href="{{ SITEURL }}/{{ article.url }}" class="post-thumbnail">
                {% if thumbnail_src %}
                <img
                    src="{{ thumbnail_src }}"
                    alt="{{ article.title }}"
                    class="post-thumbnail-image"
                    loading="lazy"
                    decoding="async"
                />
                {% else %}
                <span class="post-thumbnail-visual">
                    <i data-lucide="image" size="58"></i>
                </span>
                {% endif %}
            </a>

            <div class="post-content">
                <div class="post-meta">
                    <time datetime="{{ article.date.isoformat() }}">{{ article.locale_date }}</time>
                    {% if article.category %}
                    <span class="post-separator">|</span>
                    <span class="post-category">{{ article.category }}</span>
                    {% endif %}
                </div>
                <h2 class="post-title">
                    <a href="{{ SITEURL }}/{{ article.url }}" class="post-title-link">{{ article.title }}</a>
                </h2>
                {% if article.summary %}
                <p class="post-excerpt">{{ article.summary | striptags }}</p>
                {% else %}
                <p class="post-excerpt">{{ article.content | striptags | truncate(140) }}</p>
                {% endif %}
                <a href="{{ SITEURL }}/{{ article.url }}" class="read-more">続きを読む →</a>
            </div>
        </article>
        {% endfor %}
    {% else %}
    <article class="empty-state">
        <h2>準備中</h2>
        <p>記事はこれから追加します。</p>
    </article>
    {% endif %}
</div>

{% if articles_page and articles_paginator.num_pages > 1 %}
<nav class="pager-nav">
    <ul>
        {% if articles_page.has_previous() %}
        <li><a href="{{ SITEURL }}/{{ articles_previous_page.url }}" class="secondary">← 前へ</a></li>
        {% else %}
        <li><a href="#" class="secondary" aria-disabled="true">← 前へ</a></li>
        {% endif %}
        {% if articles_page.has_next() %}
        <li><a href="{{ SITEURL }}/{{ articles_next_page.url }}" class="secondary">次へ →</a></li>
        {% else %}
        <li><a href="#" class="secondary" aria-disabled="true">次へ →</a></li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% endblock content %}
