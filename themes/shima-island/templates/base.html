<!DOCTYPE html>
<html lang="{{ DEFAULT_LANG }}" data-theme="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}{{ SITENAME }}{% endblock title %}</title>
    <meta name="description" content="{% block page_description %}{{ SITENAME }}{% endblock page_description %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <link rel="stylesheet" href="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/css/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@400;500;700;800&family=Zen+Kaku+Gothic+New:wght@500;700&display=swap" rel="stylesheet" />
    <script src="https://unpkg.com/lucide@latest"></script>
    {% block extra_head %}{% endblock extra_head %}
</head>
<body>
    <header>
        <div class="container">
            <nav class="site-nav">
                <ul>
                    <li>
                        <a href="{{ SITEURL }}/" class="contrast brand-title">{{ SITENAME }}</a>
                    </li>
                </ul>
                <ul>
                    <li><a href="{{ SITEURL }}/archives.html" class="secondary">Archives</a></li>
                    <li>
                        <button id="theme-toggle" class="theme-toggle" aria-label="テーマ切り替え">
                            <i data-lucide="sun" class="icon-sun"></i>
                            <i data-lucide="moon" class="icon-moon" style="display: none;"></i>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    {% set layout_mode %}{% block layout_mode %}with-sidebar{% endblock layout_mode %}{% endset %}
    {% set profile_name = PROFILE_NAME | default("shima", true) %}
    {% set profile_image_url = PROFILE_IMAGE_URL | default("https://ui-avatars.com/api/?name=shima&background=f97316&color=fff&size=128", true) %}
    {% set profile_bio_lines = PROFILE_BIO_LINES | default(("個人サイトのリニューアルを進めています。", "開発メモと制作記録を順次公開予定です。"), true) %}
    {% set profile_social_links = PROFILE_SOCIAL_LINKS | default((("GitHub", "https://github.com/shima10-x1p", "github"),), true) %}
    {% set sidebar_content %}
        {% block sidebar %}
        <div class="profile-card">
            <img src="{{ profile_image_url }}" alt="{{ profile_name }}" class="profile-img" />
            <h3 class="profile-name">{{ profile_name }}</h3>
            <p class="profile-bio">
                {% for line in profile_bio_lines %}
                {{ line }}{% if not loop.last %}<br />{% endif %}
                {% endfor %}
            </p>
            <div class="social-links">
                {% for social_item in profile_social_links %}
                {% set social_name = social_item[0] %}
                {% set social_url = social_item[1] %}
                {% set social_icon = social_item[2] if social_item | length > 2 else "link" %}
                <a href="{{ social_url }}" class="secondary" aria-label="{{ social_name }}" target="_blank" rel="noopener noreferrer">
                    <i data-lucide="{{ social_icon }}"></i>
                    <span class="visually-hidden">{{ social_name }}</span>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endblock sidebar %}
    {% endset %}

    <main class="container">
        <div class="layout-grid{% if layout_mode | trim == 'single' %} layout-single{% endif %}">
            <div>
                {% block content %}{% endblock content %}
            </div>
            {% if layout_mode | trim != 'single' %}
            <aside>
                {{ sidebar_content }}
            </aside>
            {% endif %}
        </div>
    </main>

    <footer class="container site-footer">
        <p>&copy; 2026 {{ SITENAME }}. Built with Pelican + Pico CSS.</p>
    </footer>

    <script>
        lucide.createIcons();
        const themeToggleButton = document.getElementById("theme-toggle");
        const root = document.documentElement;
        const iconSun = document.querySelector(".icon-sun");
        const iconMoon = document.querySelector(".icon-moon");

        const updateIcons = (theme) => {
            if (theme === "dark") {
                iconSun.style.display = "none";
                iconMoon.style.display = "block";
                return;
            }
            iconSun.style.display = "block";
            iconMoon.style.display = "none";
        };

        const initializeTheme = () => {
            const stored = localStorage.getItem("shima-theme");
            const initial = stored || "light";
            root.setAttribute("data-theme", initial);
            updateIcons(initial);
        };

        if (themeToggleButton) {
            themeToggleButton.addEventListener("click", () => {
                const current = root.getAttribute("data-theme") || "light";
                const next = current === "light" ? "dark" : "light";
                root.setAttribute("data-theme", next);
                localStorage.setItem("shima-theme", next);
                updateIcons(next);
            });
        }

        initializeTheme();
    </script>
</body>
</html>
